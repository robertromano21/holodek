<html>
<head>
  <meta name="robots" content="noindex">
  <meta charset="utf-8">
  <meta name="generator" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
 <script src="/node_modules/phaser/dist/phaser.min.js"></script>
<audio id="room-music" src="/sid/current_room.wav" loop autoplay></audio>
 <script src="/assets/game.js"></script>
   <script>
   
   // Enhanced playRoomMusic with status feedback
function playRoomMusic() {
  const audio = document.getElementById('room-music');
  const statusElement = document.getElementById('music-status') || document.createElement('div');
  if (!statusElement.id) {
    statusElement.id = 'music-status';
    statusElement.style.position = 'fixed';
    statusElement.style.top = '100px';
    statusElement.style.left = '10px';
    statusElement.style.color = 'white';
    statusElement.style.zIndex = '1100';
    document.body.appendChild(statusElement);
  }
  statusElement.textContent = 'Loading room music...';
  audio.load();
  audio.play()
    .then(() => {
      statusElement.textContent = 'Playing room music';
    })
    .catch(err => {
      console.warn('Autoplay blocked or error:', err);
      statusElement.textContent = 'Click "Play Music" to start audio';
      const playBtn = document.getElementById('play-music-btn');
      if (playBtn) playBtn.style.display = 'block';
    });
}

// SSE listener for room music updates
document.addEventListener('DOMContentLoaded', () => {
  const eventSource = new EventSource('/combat-updates2');
  eventSource.onmessage = function(event) {
      
  if (event.data && event.data.startsWith('ping')) {
    return;
  }
    
    try {
      const data = JSON.parse(event.data);
      if (data.type === 'roomMusicUpdated' && data.isNew) {
        console.log('New room music detected for coords:', data.coords);
        playRoomMusic();
      }
    } catch (err) {
      console.error('SSE parse error:', err);
    }
  };
  eventSource.onerror = function() {
    console.error('SSE connection error');
    document.getElementById('music-status').textContent = 'Music connection lost';
  };
});

// Enhance existing poll-task logic (if you have it)
function enhancePollTask() {
  const originalPoll = window.pollTask; // Assuming your poll function is global or in game.js
  if (originalPoll) {
    window.pollTask = function(taskId) {
      originalPoll(taskId).then(data => {
        if (data.result && data.result.musicArrangement && data.result.isNewRoom) {
          console.log('Poll detected new room music');
          playRoomMusic();
        }
      });
    };
  }
}
enhancePollTask();

function toggleCombatMode() {
  const select = document.getElementById('combat-mode-select');
  const currentCombatMode = select.value;
  
  // Set the global combatMode
  window.combatMode = currentCombatMode;
  
  // Show/hide the combat button and popup based on mode
  const combatButton = document.getElementById('open-combat-button');
  if (currentCombatMode === 'No Combat Map') {
    combatButton.style.display = 'none';
    document.getElementById('combat-popup').style.display = 'none';
  } else {
    combatButton.style.display = 'block';
  }

  // Send update to /set-combat-mode
  fetch('/set-combat-mode2', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ mode: currentCombatMode })
  })
  .then(response => {
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    return response.json();
  })
  .then(data => console.log('Combat mode updated:', data))
  .catch(error => console.error('Error updating combat mode:', error));
}
   
   document.addEventListener('DOMContentLoaded', () => {
      // Game console popup dragging
      const popup = document.getElementById('phaser-popup');
      const header = document.getElementById('phaser-header');
      let isDragging = false;
      let offsetX = 0;
      let offsetY = 0;

      header.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.clientX - popup.offsetLeft;
        offsetY = e.clientY - popup.offsetTop;
        header.style.cursor = 'grabbing';
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        const newX = e.clientX - offsetX;
        const newY = e.clientY - offsetY;
        const maxX = window.innerWidth - popup.offsetWidth;
        const maxY = window.innerHeight - popup.offsetHeight;
        popup.style.left = `${Math.min(Math.max(0, newX), maxX)}px`;
        popup.style.top = `${Math.min(Math.max(0, newY), maxY)}px`;
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
        header.style.cursor = 'grab';
      });

      // Combat popup dragging
      const combatPopup = document.getElementById('combat-popup');
      const combatHeader = document.getElementById('combat-header');
      let combatIsDragging = false;
      let combatOffsetX = 0;
      let combatOffsetY = 0;

      combatHeader.addEventListener('mousedown', (e) => {
        combatIsDragging = true;
        combatOffsetX = e.clientX - combatPopup.offsetLeft;
        combatOffsetY = e.clientY - combatPopup.offsetTop;
        combatHeader.style.cursor = 'grabbing';
      });

      document.addEventListener('mousemove', (e) => {
        if (!combatIsDragging) return;
        const newX = e.clientX - combatOffsetX;
        const newY = e.clientY - combatOffsetY;
        const maxX = window.innerWidth - combatPopup.offsetWidth;
        const maxY = window.innerHeight - combatPopup.offsetHeight;
        combatPopup.style.left = `${Math.min(Math.max(0, newX), maxX)}px`;
        combatPopup.style.top = `${Math.min(Math.max(0, newY), maxY)}px`;
      });

      document.addEventListener('mouseup', () => {
        combatIsDragging = false;
        combatHeader.style.cursor = 'grab';
      });
      
            // Dungeon popup dragging
      const dungeonPopup = document.getElementById('dungeon-popup');
      const dungeonHeader = document.getElementById('dungeon-header');
      let dungeonIsDragging = false;
      let dungeonOffsetX = 0;
      let dungeonOffsetY = 0;

      dungeonHeader.addEventListener('mousedown', (e) => {
        dungeonIsDragging = true;
        dungeonOffsetX = e.clientX - dungeonPopup.offsetLeft;
        dungeonOffsetY = e.clientY - dungeonPopup.offsetTop;
        dungeonHeader.style.cursor = 'grabbing';
      });

      document.addEventListener('mousemove', (e) => {
        if (!dungeonIsDragging) return;
        const newX = e.clientX - dungeonOffsetX;
        const newY = e.clientY - dungeonOffsetY;
        const maxX = window.innerWidth - dungeonPopup.offsetWidth;
        const maxY = window.innerHeight - dungeonPopup.offsetHeight;
        dungeonPopup.style.left = `${Math.min(Math.max(0, newX), maxX)}px`;
        dungeonPopup.style.top  = `${Math.min(Math.max(0, newY), maxY)}px`;
        dungeonPopup.style.right = 'auto'; // once dragged, we control left
      });

      document.addEventListener('mouseup', () => {
        dungeonIsDragging = false;
        dungeonHeader.style.cursor = 'grab';
      });

    });

    function togglePopup() {
      const popup = document.getElementById('phaser-popup');
      popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
      if (popup.style.display === 'block') {
        popup.style.top = '5px';
        popup.style.right = '5px';
      }
    }

    function toggleCombatPopup() {
        const combatPopup = document.getElementById('combat-popup');
        combatPopup.style.display = combatPopup.style.display === 'block' ? 'none' : 'block';
        if (combatPopup.style.display === 'block') {
            combatPopup.style.top = '105px';
            combatPopup.style.left = '5px';

            // Center the combat map on the PC when opening, using global character data
            const combatScene = window.combatGame.scene.getScene('CombatScene');
            if (combatScene) {
                const pc = window.combatCharacters?.find(c => c.type === 'pc');
                if (pc) {
                    combatScene.centerCameraOn(pc.x, pc.y);
                    console.log(`Centering on PC at (${pc.x}, ${pc.y}) from toggleCombatPopup`);
                } else {
                    console.log("No PC found in combatCharacters, centering on grid center");
                    combatScene.centerCameraOn(Math.floor(10 / 2), Math.floor(10 / 2)); // Center at (15, 15)
                }
            } else {
                console.warn("CombatScene not found!");
            }
        }
    }
    
    function toggleDungeonPopup() {
        const dungeonPopup = document.getElementById('dungeon-popup');
        if (!dungeonPopup) return;

        dungeonPopup.style.display = dungeonPopup.style.display === 'block' ? 'none' : 'block';

        if (dungeonPopup.style.display === 'block') {
            dungeonPopup.style.top = '105px';
            dungeonPopup.style.right = '5px';
            dungeonPopup.style.left = 'auto';

            // Draw/refresh the view when it opens
            if (typeof renderDungeonView === 'function') {
              renderDungeonView();
            }
        }
    }


    function scrollToBottom() {
      var chatbotButton = document.getElementById("chatbotbutton");
      chatbotButton.scrollIntoView({ behavior: 'smooth', block: 'end' });
    }

    function updateChatLog(newContent) {
      var chatLog = document.getElementById("chatlog");
      chatLog.innerHTML += newContent;
      scrollToBottom();
    }
  </script>
 <title></title>
  <style>
    ::-webkit-scrollbar {
      display: none;
    }
    
    body {
      background-color: black !important;
      zoom: 175%;
    }
    
    #divchatbot {
      width: 100%;
      text-align: center;
      padding: 10px 0;
      background-color: #000000;
    }
    
    #chatbotcontainer {
      border-style: solid;
      position: fixed;
      bottom: 10px;
      left: 20%;
      right: 20%;
      text-align: center;
      z-index: 1000;
      background-color: #000000;
      visibility: visible;
      height: 100%;
      overflow-y: scroll;
    }
    
    #chatlog {
      width: 95%;
      color: #ffffff;
      word-wrap: break-word;
    }
    
    #chatuserinput {
      font-size: 20px;
      width: 90%;
      word-wrap: break-word;
      height: auto;
      max-height: 500px;
      overflow-y: auto;
      resize: vertical;
    }
    
    #chatbuttons {
      justify-content: space-around;
      margin-bottom: 10px;
    }
    
    #chatbotbutton {
      font-size: 14px;
      padding: 5px 10px;
    }
    
    #phaser-popup {
        display: none; /* Start hidden by default */
        position: absolute;
        top: 5px; /* Top-right positioning */
        right: 5px;
        width: 200px; /* Set width */
        height: 300px; /* Set height */
        background-color: black; /* Match the container */
        color: white;
        border: 1px solid white;
        border-radius: 8px; /* Rounded corners */
        z-index: 1500; /* Ensure it’s above other elements */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Subtle shadow */
        resize: both; /* Allow resizing */
        overflow: hidden; /* Prevent overflow */
        padding: 0; /* Remove padding from the parent */
        margin: 0; /* Remove any margin */
        box-sizing: border-box; /* Include borders in width/height */
        pointer-events: auto;
    }
    
    #phaser-header {
        background-color: #333;
        color: white;
        padding: 10px;
        cursor: grab; /* Indicates draggable behavior */
        font-family: Arial, sans-serif;
        font-size: 13px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid white; /* Visual separation */
    }

    
    #phaser-container {
        width: 100%; /* Match the popup width */
        height: calc(100% - 40px); /* Subtract the header height */
        overflow-y: auto; /* Enable vertical scrolling */
        padding: 10px; /* Add padding inside the container */
        font-family: monospace;
        font-size: 8px;
        color: white;
        background-color: black; /* Match popup background */
        white-space: pre-wrap; /* Preserve line breaks */
        box-sizing: border-box; /* Include padding in width calculation */
        z-index: 2000; /* Ensure it's above other elements */

        /* Custom scrollbar */
        scrollbar-width: 50px; /* Firefox: Thin scrollbar */
        scrollbar-color: grey black; /* Firefox: Thumb color / Track color */
    }
    
    #phaser-container::-webkit-scrollbar {
        width: 50px; /* Width of the scrollbar */
    }
    
    #phaser-container::-webkit-scrollbar-track {
        background: black; /* Track color */
    }
    
    #phaser-container::-webkit-scrollbar-thumb {
        background-color: grey; /* Scrollbar thumb color */
        border-radius: 0; /* Remove rounding */
        border: 2px solid black; /* Space between thumb and track */
    
        /* Fixed square size */
        height: 50px; /* Make the thumb square */
        min-height: 50px; /* Prevent smaller sizes */
    }
    
    #phaser-container::-webkit-scrollbar-thumb:hover {
        background-color: lightgrey; /* Lighter grey on hover */
    }
    
    .clickable-object {
      color: #ffffff; /* Green color to indicate it's interactive */
      text-decoration: underline; /* Optional: underline for clarity */
      cursor: pointer; /* Change cursor to pointer on hover */
    }
    
    .clickable-object:hover {
      color: grey; /* Slightly darker green on hover */
      text-decoration: none; /* Remove underline on hover */
    }
    
    .clickable-inventory {
      color: #ffffff; /* Green color to indicate it's interactive */
      text-decoration: underline; /* Optional: underline for clarity */
      cursor: pointer; /* Change cursor to pointer on hover */
    }
    
    .clickable-inventory:hover {
      color: grey; /* Slightly darker green on hover */
      text-decoration: none; /* Remove underline on hover */
    }

    .clickable-equipped {
        color: #ffffff; /* White to indicate it's interactive */
        text-decoration: underline; /* Optional: underline for clarity */
        cursor: pointer; /* Change cursor to pointer on hover */
    }
    
    .clickable-equipped:hover {
        color: grey; /* Slightly darker white on hover */
        text-decoration: none; /* Remove underline on hover */
    }

    .clickable-exit {
        color: #ffffff; /* Bright yellow for visibility */
        text-decoration: underline; /* Optional: underline for clarity */
        cursor: pointer; /* Change cursor to pointer on hover */
    }
    
    .clickable-exit:hover {
        color: grey; /* Slightly darker yellow on hover */
        text-decoration: none; /* Remove underline on hover */
    }

    .clickable-npc {
        color: #ffffff; /* Bright red to indicate interaction */
        text-decoration: underline; /* Optional: underline for clarity */
        cursor: pointer; /* Change cursor to pointer on hover */
    }
    
    .clickable-npc:hover {
        color: grey; /* Slightly darker red on hover */
        text-decoration: none; /* Remove underline on hover */
    }
    
    .clickable-monster {
        color: #ffffff; /* Bright green to indicate interaction */
        text-decoration: underline; /* Optional: underline for clarity */
        cursor: pointer; /* Change cursor to pointer on hover */
    }
    
    .clickable-monster:hover {
        color: grey; /* Slightly darker green on hover */
        text-decoration: none; /* Remove underline on hover */
    }

    .popup-container {
        position: absolute;
        top: 310px;
        right: 5px;
        width: 200px;
        background-color: rgba(0, 0, 0, 0.9); /* Semi-transparent black */
        border: 1px solid white;
        border-radius: 8px;
        padding: 0;
        box-sizing: border-box;
        color: white;
        font-family: Arial, sans-serif;
        font-size: 14px;
        z-index: 3000; /* Ensure it’s above other elements */
        text-align: center;
    }

    /* Popup buttons */
    .popup-button {
        background-color: #444;
        color: white;
        border: none;
        padding: 5px 10px;
        margin: 5px;
        cursor: pointer;
        border-radius: 5px;
    }

    .popup-button:hover {
        background-color: #666; /* Slightly lighter background on hover */
    }
    
    .popup-container select {
        background-color: #222;
        color: white;
        border: 1px solid white;
        padding: 5px;
        border-radius: 5px;
        font-size: 14px;
        margin: 10px 0;
    }
    
    .popup-container select:focus {
        outline: none;
        box-shadow: 0 0 5px #444;
    }
    
    .popup-container #confirm-equip {
        background-color: #00ff00;
        color: black;
        border: none;
        padding: 5px 10px;
        margin: 5px;
        cursor: pointer;
        border-radius: 5px;
    }
    
    .popup-container #cancel-equip {
        background-color: #ff0000;
        color: black;
        border: none;
        padding: 5px 10px;
        margin: 5px;
        cursor: pointer;
        border-radius: 5px;
    }
    
    .npc-block {
        margin-left: 20px; /* Adjust the value for your desired indentation */
        white-space: pre-wrap; /* Preserve formatting */
        font-family: monospace; /* Match game console styling */
    }
    

    .pc-block {
        margin-left: 20px; /* Adjust the value for your desired indentation */
        white-space: pre-wrap; /* Preserve formatting */
        font-family: monospace; /* Match game console styling */
    }
    
    .monster-block {
        margin-left: 20px; /* Adjust the value for your desired indentation */
        white-space: pre-wrap; /* Preserve formatting */
        font-family: monospace; /* Match game console styling */
    }

    #game-container {
        background-color: #222;
    }
    .tile {
        border: 1px solid #444;
    }

  #combat-popup {
    display: none;
    position: absolute;
    top: 105px;
    left: 5px;
    width: 170px;
    height: 250px;
    background-color: black;
    color: white;
    border: 1px solid white;
    border-radius: 8px;
    z-index: 2000;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    resize: both;
    overflow: hidden;
    padding: 0;
    margin: 0;
    box-sizing: border-box;
    pointer-events: auto;
  }

  #combat-header {
    background-color: #333;
    color: white;
    padding: 10px;
    cursor: grab;
    font-family: Arial, sans-serif;
    font-size: 13px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid white;
  }

  #combat-container {
    width: 100%; /* Match the popup width */
    height: calc(100% - 40px); 
    background-color: #333333;
    overflow: auto; /* Enable scrolling */
    position: relative; /* Ensure child positioning works */
    /* Custom scrollbar styling */
    scrollbar-width: 50px; /* Firefox: Thin scrollbar */
    scrollbar-color: grey black; /* Firefox: Thumb color / Track color */
  }
  
    #combat-container canvas {
      width: 375px !important;
      height: 375px !important;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }

  #combat-container::-webkit-scrollbar {
    width: 50px; /* Width of the vertical scrollbar */
    height: 50px; /* Height for horizontal scrollbar */
  }

  #combat-container::-webkit-scrollbar-track {
    background: black; /* Track color */
  }

  #combat-container::-webkit-scrollbar-thumb {
    background-color: grey; /* Scrollbar thumb color */
    border-radius: 6px; /* Rounded corners */
    border: 2px solid black; /* Space between thumb and track */
  }

  #combat-container::-webkit-scrollbar-thumb:hover {
    background-color: lightgrey; /* Lighter grey on hover */
  }

  /* Updated combat mode toggle styling */
  #combat-mode-toggle {
    position: fixed;
    background-color: #444;
    color: white;
    border: none;
    cursor: pointer;
  }

  #combat-mode-toggle select {
    background-color: #444;
    color: white;
    font-size: 13px;
    border: none;
  }

  #combat-mode-toggle select:focus {
    outline: none;
  }
  
  /* Scrollable list inside popup for inventory choices */
.popup-list {
  max-height: 160px;
  overflow-y: auto;
  margin: 6px;
  text-align: left;
}

/* Optional: a bit of spacing for empty-state text */
.popup-empty {
  opacity: 0.85;
  padding: 8px 6px;
}

/* Dungeon first-person viewport popup */
#dungeon-popup {
  display: none;
  position: absolute;
  top: 105px;
  right: 5px;

  /* New larger viewport */
  width: 640px;
  height: 520px;

  background-color: black;
  color: white;
  border: 1px solid white;
  border-radius: 8px;
  box-shadow: 0 0 20px #400;
  z-index: 1200;

  /* Prevent smoothing if browser tries */
  image-rendering: pixelated;
  image-rendering: crisp-edges;
}

  #dungeon-header {
    background-color: #333;
    color: white;
    padding: 8px 10px;
    cursor: grab;
    font-family: Arial, sans-serif;
    font-size: 13px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid white;
  }

  #dungeon-container {
    width: 100%;
    height: calc(100% - 40px);
    background-color: black;
    overflow: hidden;
  }
  
  #dungeon-container canvas {
  image-rendering: pixelated;
  image-rendering: crisp-edges;
}
</style>

</head>
<body>
  <!-- Phaser Popup -->
  <div id="phaser-popup">
    <div id="phaser-header">
      Game Console
      <button onclick="document.getElementById('phaser-popup').style.display = 'none';" style="
          background: none;
          color: white;
          border: none;
          font-size: 16px;
          cursor: pointer;">X</button>
    </div>
    <div id="phaser-container"></div>
  </div>
<div id="combat-popup">
    <div id="combat-header">
        <span>Combat Mode</span>
        <button onclick="document.getElementById('combat-popup').style.display = 'none';" style="background: none; color: white; border: none; font-size: 16px; cursor: pointer;">X</button>
    </div>
    <div id="combat-container"></div>
</div>
<div id="dungeon-popup">
  <div id="dungeon-header">
    <span>Dungeon View</span>
    <button onclick="document.getElementById('dungeon-popup').style.display = 'none';"
      style="background:none;color:white;border:none;font-size:16px;cursor:pointer;">
      X
    </button>
  </div>
  <div id="dungeon-container"></div>
</div>
  <div id="divchatbot">
    <div id="chatbotcontainer">
      <p id="chatlog" align="left"><br><img src="./children-of-the-grave-logo.png" style="width:50%; text-align:center;"><br><img src="./SceneBreak.png" style="width:50%; text-align:center;"><br><br>CHILDREN OF THE GRAVE: Version 1.0<br><br><img src="https://childrenofthegrave.com/test22/Tartarus.png" style="max-width: 100%;"><br><br>You find yourself standing in the first room of the afterlife at the Ruined Temple in the underworld plane, Tartarus, a vast wasteland with a yellowish sky and vast mountains, consumed by hellish sandstorms and other winds, dark magics, ferocious monsters, dragons (celestial and otherwise) high magical beings and other entities of pure energy and form, angels and powerful demons...<br><br>The game begins in the Ruined Temple. Good luck, adventurer! Type 'Start' with nothing else in the sentence and then choose a game mode from the start menu.</p>
      <div id="game-console">
</script>
        

  <table class="character-table" style="width: 100%; border-collapse: collapse;">
    <tr>
      <td class="character-column" style="width: 14%; font-size: 8pt; color: white;">
        <script>displayPCData(charactersString);</script>
      </td>
      <td class="character-column" style="width: 14%; font-size: 8pt; color: white;">
        <script>displayAllNPCData(npcsString, 0);</script>
      </td>
      <td class="character-column" style="width: 14%; font-size: 8pt; color: white;">
          <script>displayAllNPCData(npcsString, 1);</script>
      </td>
      <td class="character-column" style="width: 14%; font-size: 8pt; color: white;">
          <script>displayAllNPCData(npcsString, 2);</script>
      </td>
      <td class="character-column" style="width: 14%; font-size: 8pt; color: white;">
          <script>displayAllNPCData(npcsString, 3);</script>
      </td>
      <td class="character-column" style="width: 14%; font-size: 8pt; color: white;">
          <script>displayAllNPCData(npcsString, 4);</script>
      </td>
      <td class="character-column" style="width: 14%; word-wrap: break-word; font-size: 8pt; color: white;">
          <script>displayAllNPCData(npcsString, 5);</script>
      </td>
    </tr>
  </table>
</div>
      <p align="left" style="width: 95%; word-wrap: break-word;"><textarea id="chatuserinput" align="left" placeholder="Type a command" onkeydown="if (event.keyCode == 13) { event.preventDefault(); chatbotprocessinput(); }  ;  if (event.keyCode == 38) { repeatuser(); }" style="width: 100%; min-height: 30px; max-height: 120px; resize: vertical;">start</textarea>
      </p>
      <div id="chatbuttons"><p align="left">
        <button type="button" onclick="chatbotprocessinput()" id="chatbotbutton">Command</button></p>
          <button type="button" onclick="document.getElementById('divchatbot').style.visibility = 'hidden' ; document.getElementById('divchatbotoff').style.visibility = 'visible'" title="" style="visibility:hidden;" id="chatbotbutton"><font size=4>Close</font></button></p>

      </div>
    </div>
  </div>
  
    <button id="open-popup-button" onclick="togglePopup()" style="position: fixed; top: 10px; left: 10px; z-index: 1100; background-color: #444; color: white; padding: 5px 10px; border: none; cursor: pointer;">Game Console</button>
    <!-- Physically placed combat mode toggle -->
    
    <div id="combat-mode-toggle" style="position: fixed; top: 40px; left: 10px; z-index: 1100; background-color: #444; color: white; padding: 4.75px 6px; border: none; cursor: pointer;">
      <select id="combat-mode-select" onchange="toggleCombatMode()">
        <option value="Combat Map-Based">Combat Map-Based</option>
        <option value="Interactive Map-Based">Interactive Map-Based</option>
        <option value="No Combat Map">No Combat Map</option>
      </select>
    </div>
    <button id="open-combat-button" onclick="toggleCombatPopup()" style="position: fixed; top: 70px; left: 10px; z-index: 1100; background-color: #444; color: white; padding: 5px 10px; border: none; cursor: pointer;">Combat Map</button>
    <button id="open-dungeon-button" onclick="toggleDungeonPopup()"
  style="position: fixed; top: 75px; right: 5px; background-color: #333; color: white; padding: 5px 10px; border: none; cursor: pointer;">
  Dungeon View
</button>
    <!-- Music control button (hidden until needed) -->
<button id="play-music-btn" style="display: none; position: fixed; top: 130px; left: 10px; z-index: 1100; background-color: #444; color: white; padding: 5px 10px; border: none; cursor: pointer;" onclick="playRoomMusic()">Play Music</button>

  <div style="display: none;"><b>Your API key (remains hidden to me): </b><input id="userapikey" value=""/></div>
</body>
</html>
